{"remainingRequest":"/Users/zhuwenyan/study/editor/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhuwenyan/study/editor/src/components/TextEditor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhuwenyan/study/editor/src/components/TextEditor.vue","mtime":1618663197681},{"path":"/Users/zhuwenyan/study/editor/node_modules/cache-loader/dist/cjs.js","mtime":1608104016032},{"path":"/Users/zhuwenyan/study/editor/node_modules/babel-loader/lib/index.js","mtime":1608104015975},{"path":"/Users/zhuwenyan/study/editor/node_modules/cache-loader/dist/cjs.js","mtime":1608104016032},{"path":"/Users/zhuwenyan/study/editor/node_modules/vue-loader/lib/index.js","mtime":1616407163826}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVGV4dEVkaXRvcicsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHZpc2libGU6IGZhbHNlLAogICAgICBlZGl0YWJsZTogZmFsc2UsCiAgICAgIGZvcm1EYXRhOiB7CiAgICAgICAgdXJsOiAnJwogICAgICB9LAogICAgICBjb250ZW50OiAnJywKICAgICAgc2VsZWN0RWxlbWVudDogbnVsbCwgIC8vIOmAieS4reeahOaWh+Wtl+iMg+WbtAogICAgICBwb3NpdGlvbjogewogICAgICAgIHN0YXJ0OiAwLAogICAgICAgIGVuZDogMAogICAgICB9CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5lZGl0b3JBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RleHQtYXJlYScpCiAgICB0aGlzLmVkaXRvckFyZWEuaW5uZXJIVE1MID0gdGhpcy5jb250ZW50CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t5o+S5YWl6ZO+5o6lICBzdGFydC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgIGFkZExpbmsoKSB7CiAgICAgIHRoaXMudmlzaWJsZSA9IHRydWUKICAgICAgdGhpcy5mb3JtRGF0YS51cmwgPSAnJwogICAgICBjb25zdCBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkKICAgICAgLy8g5L+d5a2Y6YCJ5Lit55qE5paH5a2X6IyD5Zu0CiAgICAgIHRoaXMuc2VsZWN0RWxlbWVudCA9IHNlbGVjdGlvbi5mb2N1c05vZGUKICAgICAgdGhpcy5wb3NpdGlvbi5hbmNob3JPZmZzZXQgPSBzZWxlY3Rpb24uYW5jaG9yT2Zmc2V0CiAgICAgIHRoaXMucG9zaXRpb24uZm9jdXNPZmZzZXQgPSBzZWxlY3Rpb24uZm9jdXNPZmZzZXQKICAgIH0sCiAgICBvblNhdmVMaW5rKCkgewogICAgICB0aGlzLiRyZWZzLmZvcm1EZWYudmFsaWRhdGUodmFsaWQgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgY29uc3Qgc1RleHQgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkKICAgICAgICAgIGlmICghc1RleHQpIHJldHVybgogICAgICAgICAgLy8g5LiL6Z2i5Yik5pat5Li76KaB5piv5Zug5Li65by556qX5paw5aKe6ZO+5o6l5pe277yM6aG16Z2i55qE5YWJ5qCH5bey57uP56e75Yqo5Yiw5by556qX77yM5b2T5paw5aKe6ZO+5o6l5pe277yM6KaB5bCG5YWJ5qCH5a6a5L2N5LmL5YmN57yW6L6R5Zmo6YCJ5Lit55qE5YaF5a65CiAgICAgICAgICAvLyDnm7TmjqXngrnlh7vnvJbovpHlmajnmoRh5qCH562+6L+b6KGM57yW6L6RCiAgICAgICAgICBpZiAodGhpcy5lZGl0YWJsZSkgewogICAgICAgICAgICB0aGlzLnNlbGVjdExpbmsodGhpcy5jdXJyZW50TGluaykKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOaWsOWinmHmoIfnrb7pk77mjqUKICAgICAgICAgICAgdGhpcy5zZWxlY3ROZXdMaW5rKCkKICAgICAgICAgIH0KICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdpbnNlcnRIVE1MJywgZmFsc2UsIGA8YSBocmVmPSIke3RoaXMuZm9ybURhdGEudXJsfSIgdGFyZ2V0PSJfYmxhbmsiPiR7c1RleHR9PC9hPmApOwogICAgICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2UKICAgICAgICAgIHRoaXMuY29udGVudCA9IHRoaXMuZWRpdG9yQXJlYS5pbm5lckhUTUwKICAgICAgICAgIHRoaXMub25MaXN0ZW5lckxpbmsoKQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAogICAgLy8g6YCJ5Lit54K55Ye7Yeagh+etvgogICAgc2VsZWN0TGluayhvYmopIHsKICAgICAgY29uc3Qgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpOwogICAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgIGNvbnN0IHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsKICAgICAgcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKG9iaik7IC8vIOmcgOimgemAieS4reeahGRvbeiKgueCuQogICAgICBzZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpIC8vIOS4uumAieS4reeahGRvbeiKgueCuea3u+WKoOWMuuWfnwogICAgfSwKICAgIC8vIOWvuemAieS4reWvuWHmoIfnrb7mt7vliqDpk77mjqUKICAgIHNlbGVjdE5ld0xpbmsoKSB7CiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKQogICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCkKICAgICAgLy8g6I635Y+W5LmL5YmN6YCJ5Lit55qE5paH5a2X6IyD5Zu0CiAgICAgIGNvbnN0IHJhbmdlRGl2RG9tID0gdGhpcy5zZWxlY3RFbGVtZW50OwogICAgICBjb25zdCB7IGFuY2hvck9mZnNldCwgZm9jdXNPZmZzZXQgfSA9IHRoaXMucG9zaXRpb24KICAgICAgaWYgKGFuY2hvck9mZnNldCA8IGZvY3VzT2Zmc2V0KSB7CiAgICAgICAgcmFuZ2Uuc2V0U3RhcnQocmFuZ2VEaXZEb20sIGFuY2hvck9mZnNldCkKICAgICAgICByYW5nZS5zZXRFbmQocmFuZ2VEaXZEb20sIGZvY3VzT2Zmc2V0KQogICAgICB9IGVsc2UgewogICAgICAgIHJhbmdlLnNldFN0YXJ0KHJhbmdlRGl2RG9tLCBmb2N1c09mZnNldCkKICAgICAgICByYW5nZS5zZXRFbmQocmFuZ2VEaXZEb20sIGFuY2hvck9mZnNldCkKICAgICAgfQogICAgICAvLyDnp7vpmaTlvZPliY3miYDmnInpgInljLoKICAgICAgc2VsZWN0aW9uLnJlbW92ZUFsbFJhbmdlcygpCiAgICAgIHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSkKICAgIH0sCiAgICAvLyDnm5HlkKzpk77mjqXngrnlh7vkuovku7YKICAgIG9uTGlzdGVuZXJMaW5rKCkgewogICAgICBjb25zdCBzZWxmID0gdGhpcwogICAgICBzZWxmLmVkaXRhYmxlID0gZmFsc2UKICAgICAgY29uc3QgYWhyZWYgPSB0aGlzLmVkaXRvckFyZWEuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImEiKTsKICAgICAgYWhyZWYuZm9yRWFjaCgoaHJlZikgPT4gewogICAgICAgIGhyZWYuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyDorrDlvZXngrnlh7th5qCH562+CiAgICAgICAgICBzZWxmLmN1cnJlbnRMaW5rID0gdGhpcwogICAgICAgICAgc2VsZi5lZGl0YWJsZSA9IHRydWUKICAgICAgICAgIHNlbGYuc2VsZWN0TGluayh0aGlzKQoKICAgICAgICAgIHNlbGYudmlzaWJsZSA9IHRydWUKICAgICAgICAgIHNlbGYuZm9ybURhdGEudXJsID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2hyZWYnKQogICAgICAgIH0sIGZhbHNlKTsKICAgICAgfSkKICAgIH0sCiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t5o+S5YWl6ZO+5o6lICBlbmQtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICAvLyDlpI3liLYKICAgIGhhbmRsZUNvbW1hbmQoY29tbWFuZCkgewogICAgICBjb25zdCBzVGV4dCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKQogICAgICBkb2N1bWVudC5leGVjQ29tbWFuZChjb21tYW5kLCBmYWxzZSwgc1RleHQpOwogICAgfQogIH0KfQo="},{"version":3,"sources":["TextEditor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TextEditor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"text-container\">\n    <p>自定义富文本编辑器</p>\n    <!-- 工具栏 -->\n    <div id=\"control-area\">\n      <el-button @click=\"addLink\" size=\"mini\">插入链接</el-button>\n      <el-button @click=\"handleCommand('copy')\" size=\"mini\">复制</el-button>\n      <el-button @click=\"handleCommand('cut')\" size=\"mini\">剪切</el-button>\n      <el-button @click=\"handleCommand('selectAll')\" size=\"mini\">全选</el-button>\n      <el-button @click=\"handleCommand('strikeThrough')\" size=\"mini\">删除线</el-button>\n      <el-button @click=\"handleCommand('justifyLeft')\" size=\"mini\">左</el-button>\n      <el-button @click=\"handleCommand('justifyCenter')\" size=\"mini\">居中</el-button>\n      <el-button @click=\"handleCommand('justifyRight')\" size=\"mini\">右</el-button>\n      <el-button @click=\"handleCommand('italic')\" size=\"mini\">斜体</el-button>\n      <el-button @click=\"handleCommand('underline')\" size=\"mini\">下划线</el-button>\n      <el-button @click=\"handleCommand('undo')\" size=\"mini\">撤销</el-button>\n      <el-button @click=\"handleCommand('redo')\" size=\"mini\">重做</el-button>\n    </div>\n    <!-- 文本编辑器 -->\n    <div id=\"text-area\" contenteditable></div>\n    <br />\n    <!-- 插入链接 -->\n    <el-dialog\n      width=\"30%\"\n      title=\"插入链接\"\n      :visible.sync=\"visible\"\n      append-to-body>\n      <el-form class=\"text-form\" ref=\"formDef\" :model=\"formData\">\n        <el-form-item label=\"链接\" prop=\"url\" required>\n          <el-input placeholder=\"请输入链接\" v-model=\"formData.url\"></el-input>\n        </el-form-item>\n      </el-form>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"visible = false\">取 消</el-button>\n\n        <el-button type=\"primary\" @click=\"onSaveLink\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'TextEditor',\n  data() {\n    return {\n      visible: false,\n      editable: false,\n      formData: {\n        url: ''\n      },\n      content: '',\n      selectElement: null,  // 选中的文字范围\n      position: {\n        start: 0,\n        end: 0\n      }\n    }\n  },\n  mounted() {\n    this.editorArea = document.getElementById('text-area')\n    this.editorArea.innerHTML = this.content\n  },\n  methods: {\n    //--------------------------------插入链接  start----------------------------------------\n    addLink() {\n      this.visible = true\n      this.formData.url = ''\n      const selection = window.getSelection()\n      // 保存选中的文字范围\n      this.selectElement = selection.focusNode\n      this.position.anchorOffset = selection.anchorOffset\n      this.position.focusOffset = selection.focusOffset\n    },\n    onSaveLink() {\n      this.$refs.formDef.validate(valid => {\n        if (valid) {\n          const sText = window.getSelection()\n          if (!sText) return\n          // 下面判断主要是因为弹窗新增链接时，页面的光标已经移动到弹窗，当新增链接时，要将光标定位之前编辑器选中的内容\n          // 直接点击编辑器的a标签进行编辑\n          if (this.editable) {\n            this.selectLink(this.currentLink)\n          } else {\n            // 新增a标签链接\n            this.selectNewLink()\n          }\n          document.execCommand('insertHTML', false, `<a href=\"${this.formData.url}\" target=\"_blank\">${sText}</a>`);\n          this.visible = false\n          this.content = this.editorArea.innerHTML\n          this.onListenerLink()\n        }\n      });\n    },\n    // 选中点击a标签\n    selectLink(obj) {\n      const selection = window.getSelection();\n      selection.removeAllRanges();\n      const range = document.createRange();\n      range.selectNodeContents(obj); // 需要选中的dom节点\n      selection.addRange(range) // 为选中的dom节点添加区域\n    },\n    // 对选中对a标签添加链接\n    selectNewLink() {\n      const selection = window.getSelection()\n      const range = document.createRange()\n      // 获取之前选中的文字范围\n      const rangeDivDom = this.selectElement;\n      const { anchorOffset, focusOffset } = this.position\n      if (anchorOffset < focusOffset) {\n        range.setStart(rangeDivDom, anchorOffset)\n        range.setEnd(rangeDivDom, focusOffset)\n      } else {\n        range.setStart(rangeDivDom, focusOffset)\n        range.setEnd(rangeDivDom, anchorOffset)\n      }\n      // 移除当前所有选区\n      selection.removeAllRanges()\n      selection.addRange(range)\n    },\n    // 监听链接点击事件\n    onListenerLink() {\n      const self = this\n      self.editable = false\n      const ahref = this.editorArea.getElementsByTagName(\"a\");\n      ahref.forEach((href) => {\n        href.addEventListener(\"click\", function () {\n          // 记录点击a标签\n          self.currentLink = this\n          self.editable = true\n          self.selectLink(this)\n\n          self.visible = true\n          self.formData.url = this.getAttribute('href')\n        }, false);\n      })\n    },\n    //--------------------------------插入链接  end----------------------------------------\n    // 复制\n    handleCommand(command) {\n      const sText = window.getSelection()\n      document.execCommand(command, false, sText);\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n// 编辑器\n#text-container {\n  text-align: left;\n  #control-area {\n    width: 90%;\n    margin-bottom: 10px;\n    .link {\n      height: 30px;\n      line-height: 30px;\n      display: inline-block;\n      &:first-child {\n        margin-right: 20px;\n      }\n      &:hover {\n        color: #409eff;\n      }\n    }\n  }\n  #text-area{\n    width: 90%;\n    height: 300px;\n    line-height: 1.5;\n    border: 1px solid #DCDFE6;\n    padding: 5px 15px;\n    box-sizing: border-box;\n    color: #606266;\n    font-size: 14px;\n    border-radius: 4px;\n  }\n}\n</style>\n"]}]}